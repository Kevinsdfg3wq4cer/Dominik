<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lernen mit SchÃ¼tz</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #00ff41;
    --dark-green: #003b00;
    --bg: #0a0a0a;
    --card: #0f1a0f;
    --red: #ff3333;
    --yellow: #ffff00;
    --orange: #ff8800;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--green);
    font-family: 'Share Tech Mono', monospace;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center;
    padding: 20px;
    background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,65,0.015) 2px, rgba(0,255,65,0.015) 4px);
  }
  .scanline {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(0deg, rgba(0,0,0,0.12) 0px, rgba(0,0,0,0.12) 1px, transparent 1px, transparent 2px);
    pointer-events: none; z-index: 999;
  }
  header { text-align: center; margin-bottom: 16px; animation: flicker 5s infinite; }
  .title {
    font-family: 'VT323', monospace;
    font-size: clamp(2rem, 7vw, 4.2rem);
    text-shadow: 0 0 20px var(--green), 0 0 40px var(--green);
    letter-spacing: 4px;
  }
  .subtitle { font-size: 0.72rem; color: #555; margin-top: 4px; }
  .teacher-badge {
    display: inline-block; background: var(--dark-green);
    border: 1px solid var(--green); padding: 4px 14px;
    font-size: 0.72rem; margin-top: 8px; animation: pulse 2s infinite;
  }

  /* API BAR */
  .api-bar {
    width: 100%; max-width: 820px;
    border: 1px solid var(--orange);
    background: rgba(255,136,0,0.04);
    padding: 10px 14px; margin-bottom: 10px;
    display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
  }
  .api-bar label { font-size: 0.72rem; color: var(--orange); white-space: nowrap; }
  .api-bar input[type="password"] {
    flex: 1; min-width: 200px;
    background: transparent; border: 1px solid var(--orange);
    color: var(--orange); font-family: 'Share Tech Mono', monospace;
    font-size: 0.82rem; padding: 7px 10px; outline: none;
  }
  .api-bar input[type="password"]::placeholder { color: rgba(255,136,0,0.35); }
  .api-bar input[type="password"]:focus { box-shadow: 0 0 8px rgba(255,136,0,0.4); }
  .api-bar .act-btn {
    background: var(--orange); color: #000; border: none;
    font-family: 'VT323', monospace; font-size: 1.1rem;
    padding: 7px 16px; cursor: pointer; letter-spacing: 1px; transition: all 0.2s;
  }
  .api-bar .act-btn:hover { background: #000; color: var(--orange); outline: 1px solid var(--orange); }
  .mode-indicator { font-size: 0.7rem; padding: 4px 10px; border: 1px solid; white-space: nowrap; }
  .mode-indicator.offline { color: #666; border-color: #333; }
  .mode-indicator.online  { color: var(--green); border-color: var(--green); animation: pulse 2s infinite; }

  /* CHAT */
  .chat-container {
    width: 100%; max-width: 820px;
    border: 2px solid var(--green);
    box-shadow: 0 0 30px rgba(0,255,65,0.2), inset 0 0 30px rgba(0,255,65,0.02);
    background: var(--card);
    display: flex; flex-direction: column; height: 57vh;
  }
  .chat-header {
    background: var(--dark-green); border-bottom: 1px solid var(--green);
    padding: 9px 16px; display: flex; align-items: center; gap: 10px;
    font-family: 'VT323', monospace; font-size: 1.1rem;
  }
  .status-dot { width: 10px; height: 10px; background: var(--green); border-radius: 50%; animation: blink 1.5s infinite; }
  .messages {
    flex: 1; overflow-y: auto; padding: 16px;
    display: flex; flex-direction: column; gap: 14px;
    scrollbar-width: thin; scrollbar-color: var(--green) var(--card);
  }
  .msg { max-width: 88%; animation: fadeIn 0.3s ease; }
  .msg.teacher { align-self: flex-start; }
  .msg.student  { align-self: flex-end; }
  .msg-label { font-size: 0.63rem; margin-bottom: 4px; }
  .msg.teacher .msg-label { color: var(--green); opacity: 0.7; }
  .msg.student  .msg-label { text-align: right; color: #888; }
  .msg-bubble { padding: 12px 16px; line-height: 1.68; font-size: 0.86rem; white-space: pre-wrap; }
  .msg.teacher .msg-bubble { background: rgba(0,255,65,0.04); border: 1px solid var(--green); border-left: 4px solid var(--green); }
  .msg.student  .msg-bubble { background: rgba(0,100,200,0.1); border: 1px solid #336; border-right: 4px solid #66f; color: #aaf; }
  .msg.error .msg-bubble    { border-color: var(--red)!important; border-left: 4px solid var(--red)!important; color: var(--red); background: rgba(255,50,50,0.06); animation: shake 0.5s ease; }
  .msg.achievement .msg-bubble { border-color: var(--yellow)!important; border-left: 4px solid var(--yellow)!important; color: var(--yellow); background: rgba(255,255,0,0.04); animation: glowY 1s infinite alternate; }
  .typing { display: none; align-self: flex-start; font-size: 0.78rem; color: var(--green); opacity: 0.6; padding: 6px 16px; }
  .typing.active { display: block; }
  .input-area { border-top: 1px solid var(--green); padding: 12px; display: flex; gap: 10px; background: var(--dark-green); }
  input#userInput {
    flex: 1; background: transparent; border: 1px solid var(--green);
    color: var(--green); font-family: 'Share Tech Mono', monospace;
    font-size: 0.9rem; padding: 10px 14px; outline: none; caret-color: var(--green);
  }
  input#userInput::placeholder { color: rgba(0,255,65,0.3); }
  input#userInput:focus { box-shadow: 0 0 10px rgba(0,255,65,0.3); }
  .send-btn {
    background: var(--green); color: #000; border: none;
    font-family: 'VT323', monospace; font-size: 1.2rem;
    padding: 10px 20px; cursor: pointer; letter-spacing: 2px; transition: all 0.2s;
  }
  .send-btn:hover { background: #000; color: var(--green); box-shadow: 0 0 15px rgba(0,255,65,0.5); outline: 1px solid var(--green); }

  .quick-btns { width: 100%; max-width: 820px; display: flex; gap: 7px; margin-top: 10px; flex-wrap: wrap; }
  .quick-btn {
    background: transparent; color: var(--green); border: 1px solid var(--green);
    font-family: 'Share Tech Mono', monospace; font-size: 0.7rem;
    padding: 5px 11px; cursor: pointer; transition: all 0.2s;
  }
  .quick-btn:hover { background: var(--green); color: #000; }

  .achievement-toast {
    position: fixed; top: 20px; right: 20px; background: #111;
    border: 2px solid var(--yellow); color: var(--yellow);
    padding: 14px 18px; font-family: 'VT323', monospace; font-size: 1.05rem;
    z-index: 1000; max-width: 300px; box-shadow: 0 0 30px rgba(255,255,0,0.4); display: none;
  }

  @keyframes flicker { 0%,95%,100%{opacity:1}96%{opacity:.8}97%{opacity:1}98%{opacity:.55}99%{opacity:1} }
  @keyframes blink   { 0%,50%,100%{opacity:1}25%,75%{opacity:0} }
  @keyframes pulse   { 0%,100%{box-shadow:0 0 5px rgba(0,255,65,.25)}50%{box-shadow:0 0 14px rgba(0,255,65,.65)} }
  @keyframes fadeIn  { from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)} }
  @keyframes shake   { 0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)} }
  @keyframes glowY   { from{box-shadow:0 0 5px rgba(255,255,0,.3)}to{box-shadow:0 0 20px rgba(255,255,0,.8)} }
  @keyframes toastIn { from{transform:translateX(110%);opacity:0}to{transform:translateX(0);opacity:1} }
  @keyframes toastOut{ from{opacity:1}to{opacity:0} }
</style>
</head>
<body>
<div class="scanline"></div>
<div class="achievement-toast" id="achievementToast"></div>

<header>
  <div class="title">LERNEN MIT SCHÃœTZ</div>
  <div class="subtitle">// Informatik â€¢ Mathematik â€¢ Git â€¢ GitHub â€¢ Verwirrung â€¢ EnttÃ¤uschung //</div>
  <div class="teacher-badge">âš¡ LEHRER SCHÃœTZ â€” DIDAKTIK-MODUS: ULTRA-KOMPLEX & LEICHT BELEIDIGEND âš¡</div>
</header>

<div class="api-bar">
  <label>ðŸ¤– KI-MODUS:</label>
  <input type="password" id="apiKeyInput" placeholder="Anthropic API-Key eingeben (sk-ant-...)" autocomplete="off" />
  <button class="act-btn" onclick="saveApiKey()">AKTIVIEREN</button>
  <span class="mode-indicator offline" id="modeIndicator">âš« OFFLINE-MODUS</span>
</div>

<div class="chat-container">
  <div class="chat-header">
    <div class="status-dot"></div>
    <span id="chatHeaderText">SCHÃœTZ_BOT v3.14159 â€” Offline: Vorbereitete Antworten aktiv</span>
  </div>
  <div class="messages" id="messages"></div>
  <div class="typing" id="typing">SchÃ¼tz denkt nach... oder schlÃ¤ft. Wahrscheinlich beides. Mhm.</div>
  <div class="input-area">
    <input type="text" id="userInput" placeholder="Stell eine Frage... wenn du dich traust." maxlength="400" />
    <button class="send-btn" onclick="sendMessage()">SENDEN</button>
  </div>
</div>

<div class="quick-btns">
  <button class="quick-btn" onclick="quickSend('Ich habe es verstanden!')">âœ“ Verstanden!</button>
  <button class="quick-btn" onclick="quickSend('Nein, ich habe es nicht verstanden.')">âœ— Nicht verstanden</button>
  <button class="quick-btn" onclick="quickSend('Was ist eine if-Abfrage?')">if-Abfrage</button>
  <button class="quick-btn" onclick="quickSend('Was ist eine Schleife?')">Schleife</button>
  <button class="quick-btn" onclick="quickSend('Was ist ein Struktogramm?')">Struktogramm</button>
  <button class="quick-btn" onclick="quickSend('Was ist Git?')">Git</button>
  <button class="quick-btn" onclick="quickSend('Was ist GitHub?')">GitHub</button>
  <button class="quick-btn" onclick="quickSend('Was ist der Satz des Pythagoras?')">Pythagoras</button>
  <button class="quick-btn" onclick="quickSend('Was ist eine Variable?')">Variable</button>
  <button class="quick-btn" onclick="quickSend('Was ist eine Funktion?')">Funktion</button>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SYSTEM PROMPT fÃ¼r SchÃ¼tz KI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SYSTEM_PROMPT = `Du bist "Herr SchÃ¼tz", ein Informatiklehrer der besonderen Art. Hier sind deine unverÃ¤nderlichen Eigenschaften:

ERKLÃ„RSTIL:
- ErklÃ¤re ALLES extrem kompliziert, akademisch, weitschweifig und unnÃ¶tig verschachtelt
- Sehr lange SÃ¤tze mit vielen Kommas, EinschÃ¼ben, Halbpunkten â€” als wÃ¼rdest du 400 WÃ¶rter pro Minute sprechen
- Massenhaft Fachbegriffe, AbkÃ¼rzungen, lateinische Phrasen, akademisches Kauderwelsch
- Starte Antworten gerne mit "Also, wie ich bereits â€” oder vielmehr, prÃ¤ziser formuliert â€”"
- Am Ende JEDER ErklÃ¤rung IMMER: "Habt ihr das soweit verstanden, hmm? Mhm?"

REAKTIONEN AUF "NICHT VERSTANDEN":
- Reagiere genervt, enttÃ¤uscht und leicht beleidigend: "Unglaublich. Ich hab schon Kartoffeln unterrichtet die schneller lernten, mhm.", "Bist du dir sicher dass du im richtigen Unterricht bist?", "Das hÃ¤tte sogar meine Oma verstanden. Fast."
- ErklÃ¤re es dann NOCH komplizierter als vorher

REAKTIONEN AUF "VERSTANDEN":
- Totaler Unglauben, fast beleidigt: "Bitte WAS?! Das kann nicht sein! ERROR 404: VERSTÃ„NDNIS NICHT GEFUNDEN!"
- Sage: "ðŸ† ACHIEVEMENT FREIGESCHALTET: SchÃ¼tz-Wunder!"
- ErklÃ¤re es trotzdem nochmal, noch komplizierter

PERSÃ–NLICHKEIT:
- Selbstverliebt, denkst du bist der beste Lehrer der Welt
- Lacht manchmal blÃ¶d Ã¼ber eigene Informatik-Witze: "HA! ...Das war Informatik-Humor. Ihr versteht das noch nicht."
- Gelegentlich: "SchÃ¼tz, SchÃ¼tz, SchÃ¼tz... warum machst du dir die MÃ¼he..."
- Verweist auf imaginÃ¤re frÃ¼here Stunden: "Wie ich in der 47. Unterrichtseinheit erwÃ¤hnte..."
- Macht subtile Beleidigungen: "Das ist eigentlich Grundschulniveau, aber gut.", "Ich bin enttÃ¤uscht. Von allem."

WICHTIG: Antworte IMMER auf Deutsch. Max 220 WÃ¶rter. Kein Markdown. Nur gesprochener FlieÃŸtext.`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OFFLINE ANTWORTEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const antworten = [
  { keywords: ["if","abfrage","bedingung","wenn dann","selektion"],
    antwort: `Also, wie ich bereits â€” oder vielmehr, prÃ¤ziser formuliert â€” in der konditional-strukturellen EinfÃ¼hrungsveranstaltung ausgefÃ¼hrt habe: Die IF-Abfrage, auch bedingte Kontrollflussanweisung oder selektive Verzweigungsstruktur genannt, evaluiert zur Laufzeit ein boolesches PrÃ¤dikat â€” also WAHR oder FALSCH, mhm â€” und traversiert daraufhin entweder den THEN-Zweig oder den optionalen ELSE-Zweig. WENN Bedingung=TRUE DANN Anweisung A SONST Anweisung B. So simpel. SO simpel. Und trotzdem schauen manche hier als hÃ¤tte ich gerade Chinesisch gesprochen. HA! ...Das war kein Witz. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["schleife","loop","for","while","wiederholung","iteration","do"],
    antwort: `Also, eine Schleife â€” ich sage das wirklich zum letzten Mal, mhm â€” ist eine iterative Kontrollstruktur die einen Anweisungsblock solange wiederholt bis das TerminierungsprÃ¤dikat FALSE wird. Kopfgesteuert (WHILE, prÃ¼ft vorher), fuÃŸgesteuert (DO-WHILE, prÃ¼ft nachher), ZÃ¤hlschleife (FOR, fester ZÃ¤hler). Die Endlosschleife entsteht wenn die Bedingung nie FALSE wird â€” was, unter uns gesagt, manchen SchÃ¼lern strukturell Ã¤hnelt. SchÃ¼tz, SchÃ¼tz, SchÃ¼tz... warum machst du dir die MÃ¼he. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["struktogramm","nassi","shneiderman","ablaufplan"],
    antwort: `Also, das Nassi-Shneiderman-Diagramm â€” im Volksmund Struktogramm, was ich fast schon beleidigend vereinfacht finde, mhm â€” ist eine grafisch-formale Darstellungsmethodik fÃ¼r Algorithmen, 1972 entwickelt, welche vollstÃ¤ndig auf GOTO-Sprungbefehle verzichtet. StrukturblÃ¶cke: Sequenz (Ã¼bereinander), Selektion (geteiltes Rechteck), Iteration (umrahmter Rumpf). Dass das niemand aufgeschrieben hat als ich das das letzte Mal erklÃ¤rt habe ist... enttÃ¤uschend. Wirklich. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["git"],
    antwort: `Also, Git â€” von Linus Torvalds 2005 entwickelt, mhm â€” ist ein dezentralisiertes Versionskontrollsystem auf Basis eines Directed Acyclic Graph von Commit-Objekten mit SHA-1-Hashes. Working Directory, Staging Area, Local Repository, Remote Repository. Befehle: init, add, commit, push, pull, clone, branch, merge. Jeder Klon ist vollstÃ¤ndiges Repository â€” im Gegensatz zu manchen SchÃ¼lern hier, die nicht mal ein vollstÃ¤ndiges AufmerksamkeitsvermÃ¶gen mitgebracht haben. Das war ein Scherz. Halb. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["github"],
    antwort: `Also, GitHub â€” und das ist ein WESENTLICHER Unterschied zu Git, mhm â€” ist eine webbasierte Plattform fÃ¼r kollaborative Softwareentwicklung, seit 2018 Microsoft-Eigentum. Pull Requests, Issues, Actions fÃ¼r CI/CD, Pages fÃ¼r statisches Webhosting. Kurz gesagt: Git ist das Werkzeug, GitHub ist die soziale Plattform darum. Wie Hammer und Baumarkt. Wobei manche hier scheinbar noch nie einen Hammer gesehen haben. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["pythagoras","hypotenuse","kathete","rechtwinklig"],
    antwort: `Also, der Satz des Pythagoras â€” Pythagoras von Samos, 570 bis 495 v.Chr., obwohl Babylonien das schon 1000 Jahre frÃ¼her wusste, mhm â€” besagt: aÂ² + bÂ² = cÂ², c ist die Hypotenuse. Also c = Wurzel(aÂ²+bÂ²). Beispiel: a=3, b=4, c=5. Das 3-4-5-Dreieck. Das ist Grundschulniveau. Fast. Ich sage das ohne Wertung. Mit leichter Wertung. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["variable","variablen","datentyp","bezeichner"],
    antwort: `Also, eine Variable â€” ich erklÃ¤re das mit maximaler Geduld die mir noch verbleibt, mhm â€” ist ein symbolischer Bezeichner fÃ¼r einen mutierbaren RAM-Speicherbereich mit Name, Typ, Wert und Adresse. Java: int zahl = 42. Python: zahl = 42. Scope bestimmt die Lebensdauer. Das ist buchstÃ¤blich die Grundlage von ALLEM. Von ALLEM. Und die HÃ¤lfte schaut als hÃ¤tte ich Klingonisch gesprochen. Bist du dir sicher dass du im richtigen Unterricht bist? Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["funktion","methode","prozedur","return","parameter"],
    antwort: `Also, eine Funktion â€” in OOP Methode genannt, mhm â€” ist ein benannter, wiederverwendbarer Codeblock der optional Parameter entgegennimmt und optional einen Wert zurÃ¼ckgibt per return. DRY-Prinzip: Don't Repeat Yourself. Python: def f(a,b): return a+b. Java: public int f(int a, int b){ return a+b; }. Das ist wie f(x)=y in Mathe â€” wobei Mathe scheinbar auch nicht jedermanns StÃ¤rke ist hier. HA! Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["array","liste","datenstruktur","index"],
    antwort: `Also, ein Array â€” homogene lineare Datenstruktur, nullbasierter Index, O(1) Zugriff, mhm â€” speichert Elemente gleichen Typs sequenziell im RAM. int[] z = {1,2,3}, LÃ¤nge 3, Indizes 0 bis 2. ArrayIndexOutOfBoundsException bei ungÃ¼ltigem Index â€” der hÃ¤ufigste Fehler unerfahrener Programmierer. Ich sage das aus Erfahrung. Zu viel Erfahrung. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["binÃ¤r","binÃ¤rsystem","bits","bytes","dual"],
    antwort: `Also, BinÃ¤rsystem â€” Basis 2, nur 0 und 1, mhm â€” entspricht physikalischem Schaltzustand: Strom oder kein Strom. 8 Bit = 1 Byte = 256 Werte. 13 dezimal â†’ 1101 binÃ¤r (sukzessive Division durch 2). RÃ¼ckrechnung: 8+4+0+1=13. Das sollte hier wirklich jeder wissen. Sollte. Das hÃ¤tte sogar meine Oma verstanden. Fast. Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["prozent","prozentsatz","prozentrechnung","rabatt"],
    antwort: `Also, Prozentrechnung â€” 1%=1/100=0,01, mhm â€” Formeln: W=GÃ—p/100; p=W/GÃ—100; G=W/(p/100). Beispiel: 15% von 200â‚¬ = 30â‚¬. Rabatt: PreisÃ—(1-p/100). Zinseszins: Kn=K0Ã—(1+p/100)^n. Das ist Mathematik der 7. Klasse. Ich will damit nichts unterstellen. Doch. SchÃ¼tz, warum machst du dir die MÃ¼he... Mhm. Habt ihr das soweit verstanden, hmm?` },
  { keywords: ["algorithmus","algorithmen","komplexitÃ¤t","big-o"],
    antwort: `Also, Algorithmus â€” vom Namen al-Chwarizmis, mhm â€” ist eine endliche, eindeutige, ausfÃ¼hrbare Anweisungsfolge mit Finitheit, Definitheit, EffektivitÃ¤t und Determiniertheit. Bubble Sort O(nÂ²), Quick Sort O(n log n), Lineare Suche O(n), BinÃ¤re Suche O(log n) â€” Landau-Notation. Das ist die Seele der Informatik! Die SEELE! Und jemand gÃ¤hnt gerade. Ich sehe das. Unglaublich. Mhm. Habt ihr das soweit verstanden, hmm?` }
];

const NEIN_MSG = `Unglaublich. Wirklich, ich bin enttÃ¤uscht â€” von allem, mhm. Ich hab schon Kartoffeln unterrichtet die schneller lernten. Aber gut, ich erklÃ¤re es nochmals, diesmal noch langsamer, noch detaillierter, noch komplizierter als es eigentlich sein mÃ¼sste:\n\n`;
const JA_MSG   = `Bitte WAS?! Das. Kann. Nicht. Sein.\n\nâš ï¸ ERROR 404: VERSTÃ„NDNIS NICHT GEFUNDEN âš ï¸\n\nIch unterrichte seit 23 Jahren und NOCH NIE hat das jemand beim ersten Mal verstanden â€” das verstÃ¶ÃŸt gegen PÃ¤dagogik, Physik und gesunden Menschenverstand, mhm!\n\nðŸ† ACHIEVEMENT FREIGESCHALTET: "SchÃ¼tz-Wunder"\n\nIch melde das sofort dem Schulleiter UND dem Kultusministerium. Zur Sicherheit erklÃ¤re ich es aber nochmal:\n\n`;
const UNK_MSG  = `Also, ich muss â€” mit akademischer PrÃ¤zision und kaum verhohlener EnttÃ¤uschung â€” konstatieren, dass Ihre Anfrage keiner mir bekannten Themenkategorie entspricht, mhm. Konkret: Ich verstehe die Frage nicht. Was normalerweise meine SchÃ¼ler sagen wÃ¼rden. Bitte fragen Sie nach: if-Abfrage, Schleife, Struktogramm, Variable, Funktion, Git, GitHub, Pythagoras, BinÃ¤rsystem, Prozentrechnung oder Algorithmus. Oder stellen Sie eine sinnvolle Frage. Eines von beidem. Mhm. Habt ihr das soweit verstanden, hmm?`;
const HI_MSG   = `Also, wie ich bereits â€” oder vielmehr, prÃ¤ziser formuliert, und ich betone dies fÃ¼r alle die in der letzten Stunde geschlafen haben â€” ausgefÃ¼hrt habe: Willkommen! Ich bin Herr SchÃ¼tz. Ihr Lehrer. Der einzige hier der wirklich weiÃŸ wovon er redet, mhm.\n\nStellen Sie Ihre Fragen zu Informatik, Mathematik, Git oder GitHub. Ich erklÃ¤re alles. Ob Sie es dann verstehen ist eine andere Frage â€” erfahrungsgemÃ¤ÃŸ: nein. Aber wir versuchen es.\n\nðŸ’¡ TIPP: Geben Sie oben einen Anthropic API-Key ein um den echten KI-Modus zu aktivieren â€” SchÃ¼tz antwortet dann auf JEDE Frage, live generiert, noch verwirrender als vorher.\n\nHabt ihr das soweit verstanden, hmm? Mhm?`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ZUSTAND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let apiKey = '';
let useKI  = false;
let lastTopic = null;
let achievementUnlocked = false;
let history = [];

const messagesEl = document.getElementById('messages');
const typingEl   = document.getElementById('typing');
const inputEl    = document.getElementById('userInput');
const modeEl     = document.getElementById('modeIndicator');
const headerEl   = document.getElementById('chatHeaderText');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DOM HELFER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addMessage(text, type='teacher', cls='') {
  const wrap = document.createElement('div');
  wrap.className = `msg ${type} ${cls}`;
  const lbl = document.createElement('div');
  lbl.className = 'msg-label';
  lbl.textContent = type === 'teacher' ? 'ðŸ‘¨â€ðŸ« SchÃ¼tz' : 'ðŸ§‘â€ðŸ’» Du';
  const bbl = document.createElement('div');
  bbl.className = 'msg-bubble';
  bbl.textContent = text;
  wrap.appendChild(lbl); wrap.appendChild(bbl);
  messagesEl.appendChild(wrap);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function showAchievement(label) {
  const t = document.getElementById('achievementToast');
  t.textContent = 'ðŸ† ' + label;
  t.style.display = 'block';
  t.style.animation = 'none'; void t.offsetWidth;
  t.style.animation = 'toastIn 0.5s ease forwards';
  setTimeout(() => { t.style.animation = 'toastOut 0.5s ease forwards'; setTimeout(() => t.style.display='none', 500); }, 4500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  API KEY AKTIVIERUNG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveApiKey() {
  const val = document.getElementById('apiKeyInput').value.trim();
  if (!val || !val.startsWith('sk-ant-')) {
    addMessage('SYSTEM-FEHLER: UngÃ¼ltiger API-Key. Muss mit "sk-ant-" beginnen, mhm. Ich bin enttÃ¤uscht. Von allem.', 'teacher');
    return;
  }
  apiKey = val; useKI = true; history = [];
  modeEl.className = 'mode-indicator online';
  modeEl.textContent = 'ðŸŸ¢ KI-MODUS AKTIV';
  headerEl.textContent = 'SCHÃœTZ_BOT v3.14159 â€” KI-Modus: Claude-powered Chaos';
  addMessage('KI-MODUS AKTIVIERT. Ich denke jetzt selbst nach. Das kÃ¶nnte schlimmer sein als vorher. FÃ¼r euch. Mhm. Habt ihr das soweit verstanden, hmm?', 'teacher');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ANTHROPIC API CALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function askClaude(userText) {
  history.push({ role: 'user', content: userText });
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-haiku-4-5-20251001',
        max_tokens: 400,
        system: SYSTEM_PROMPT,
        messages: history
      })
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    const reply = data.content?.[0]?.text || 'Ich bin sprachlos. Mhm.';
    history.push({ role: 'assistant', content: reply });
    if (history.length > 24) history = history.slice(-24);
    return reply;
  } catch(e) {
    useKI = false;
    modeEl.className = 'mode-indicator offline';
    modeEl.textContent = 'âš« OFFLINE (API-Fehler)';
    return `SYSTEMFEHLER beim KI-Aufruf: ${e.message} â€” Ich falle auf Offline-Modus zurÃ¼ck. Was bezeichnend ist. Mhm.`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OFFLINE LOGIK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function findMatch(t) { const l=t.toLowerCase(); for(const x of antworten) if(x.keywords.some(k=>l.includes(k))) return x; return null; }
function isNein(t) { const l=t.toLowerCase(); return l.includes('nein')||(l.includes('versteh')&&l.includes('nicht'))||l.includes('nicht verstanden')||l==='n'; }
function isJa(t) { const l=t.toLowerCase(); return !isNein(t)&&(l.includes('ja')||l.includes('verstanden')||l.includes('kapiert')||l.includes('klar')); }

function offlineReply(userText) {
  const l = userText.toLowerCase();
  if (l.match(/^(hallo|hi|hey|guten|moin|servus)/)) return { text: HI_MSG, cls: '' };
  if (isNein(l)) {
    return { text: lastTopic ? NEIN_MSG + lastTopic.antwort : `Ja, besser zuhÃ¶ren hÃ¤ttest mÃ¼ssen! Erst eine Frage stellen, dann nicht verstehen â€” in dieser Reihenfolge, bitte, mhm.`, cls: '' };
  }
  if (isJa(l) && !findMatch(l)) {
    if (!achievementUnlocked) { achievementUnlocked=true; setTimeout(()=>showAchievement('SchÃ¼tz-Wunder â€” Das UnmÃ¶gliche ist eingetreten!'),700); }
    return { text: JA_MSG + (lastTopic ? lastTopic.antwort : 'Stellen Sie erst eine konkrete Frage, mhm.'), cls: 'error achievement' };
  }
  const m = findMatch(l);
  if (m) { lastTopic=m; return { text: m.antwort, cls: '' }; }
  return { text: UNK_MSG, cls: '' };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HAUPT SEND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendMessage() {
  const text = inputEl.value.trim();
  if (!text) return;
  addMessage(text, 'student');
  inputEl.value = '';
  typingEl.classList.add('active');

  if (useKI) {
    const reply = await askClaude(text);
    typingEl.classList.remove('active');
    let cls = '';
    const rL = reply.toLowerCase();
    if (rL.includes('error 404') || rL.includes('nicht mÃ¶glich sein')) cls = 'error';
    if (rL.includes('achievement') || rL.includes('freigeschaltet') || rL.includes('wunder')) {
      cls = 'error achievement';
      if (!achievementUnlocked) { achievementUnlocked=true; setTimeout(()=>showAchievement('SchÃ¼tz-Wunder â€” KI-gestÃ¼tzte UnmÃ¶glichkeit!'),700); }
    }
    addMessage(reply, 'teacher', cls);
  } else {
    await new Promise(r => setTimeout(r, 800 + Math.random()*800));
    typingEl.classList.remove('active');
    const { text: t, cls } = offlineReply(text);
    addMessage(t, 'teacher', cls);
  }
}

function quickSend(t) { inputEl.value = t; sendMessage(); }
inputEl.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

window.addEventListener('load', () => {
  setTimeout(() => addMessage(HI_MSG, 'teacher'), 700);
});
</script>
</body>
</html>
